{
  "$schema": "https://railway.app/railway.schema.json",
  "build": {
    "builder": "DOCKERFILE",
    "dockerfilePath": "backend/Dockerfile"
  },
  "deploy": {
    "numReplicas": 1,
    "sleepApplication": false,
    "restartPolicyType": "ON_FAILURE",
    "restartPolicyMaxRetries": 10
  },
  "regions": ["eu-west-1"],
  "environments": {
    "production": {
      "variables": {
        "ENVIRONMENT": "production",
        "ENABLE_CONNECTORS": "TED",
        "SHADOW_CONNECTORS": "",
        "TZ": "Europe/Paris",
        "ENABLE_SCHEDULER": "true",
        "LOG_LEVEL": "INFO",
        "RATE_LIMIT_ENABLED": "true",
        "MAX_REQUESTS_PER_MINUTE": "100"
      }
    }
  },
  "services": [
    {
      "name": "tenderpulse-api",
      "source": {
        "type": "image",
        "image": "tenderpulse/api:latest"
      },
      "variables": {
        "PORT": "${{ PORT }}",
        "DATABASE_URL": "${{ DATABASE_URL }}",
        "RESEND_API_KEY": "${{ RESEND_API_KEY }}",
        "STRIPE_SECRET_KEY": "${{ STRIPE_SECRET_KEY }}",
        "STRIPE_WEBHOOK_SECRET": "${{ STRIPE_WEBHOOK_SECRET }}",
        "CLERK_SECRET_KEY": "${{ CLERK_SECRET_KEY }}",
        "BACKEND_BASE_URL": "https://${{ RAILWAY_PUBLIC_DOMAIN }}",
        "FRONTEND_BASE_URL": "https://tenderpulse.eu"
      }
    },
    {
      "name": "tenderpulse-db",
      "source": {
        "type": "postgresql",
        "version": "15"
      },
      "variables": {
        "POSTGRES_DB": "tenderpulse_prod",
        "POSTGRES_USER": "tenderpulse",
        "POSTGRES_PASSWORD": "${{ POSTGRES_PASSWORD }}"
      },
      "volumes": [
        {
          "name": "postgres-data",
          "mountPath": "/var/lib/postgresql/data"
        }
      ],
      "deploy": {
        "region": "eu-west-1"
      }
    }
  ]
}
